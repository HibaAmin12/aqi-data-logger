name: Train AQI Prediction Model

on:
  schedule:
    - cron: '15 */3 * * *'  # Every 3 hours, 15 minutes after ingestion
  workflow_dispatch:        # Allow manual run

jobs:
  train_model:
    runs-on: ubuntu-latest

    env:
      HOPSWORKS_API_KEY: ${{ secrets.HOPSWORKS_API_KEY }}
      HOPSWORKS_PROJECT: ${{ secrets.HOPSWORKS_PROJECT }}
      HOPSWORKS_HOST: ${{ secrets.HOPSWORKS_HOST }}

    steps:
      - name: üìÇ Checkout repository
        uses: actions/checkout@v3

      - name: üêç Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: üì¶ Install dependencies
        run: |
          pip install hopsworks==4.2.4
          pip install -r requirements.txt
          pip install pandas scikit-learn xgboost joblib scipy pyarrow

      - name: ü§ñ Run model training
        run: python model_train.py

      - name: üì§ Upload model artifacts
        uses: actions/upload-artifact@v4
        with:
          name: trained-model
          path: |
            model_outputs/best_model.pkl
            model_outputs/model_metrics.json
            model_outputs/predictions.csv
